# Алгоритм планирования индивидуального плана для иностранных студентов

## Общее описание

Алгоритм предназначен для автоматического планирования задач иностранного студента с учетом его даты прибытия, приоритетов задач, их зависимостей и доступного времени. Система учитывает рабочие часы организаций, выходные, праздники и максимальную нагрузку на студента в день.

## Структура задачи

Каждая задача содержит следующие ключевые параметры для планирования:

- `priority` (1-5): приоритет задачи, где 1 - наивысший
- `deadline_days`: количество дней после прибытия, к которому задача должна быть выполнена
- `duration_minutes`: примерная длительность выполнения задачи в минутах
- `schedule`: расписание работы организации (временные слоты для каждого дня недели)
- `blocks`: список ID задач, которые блокируются этой задачей
- `blocked_by`: список ID задач, которые блокируют эту задачу

## Алгоритм планирования

### 1. Сортировка задач

Задачи сортируются по следующим критериям (в порядке приоритета):

1. Зависимости (задачи без блокировок идут первыми)
2. Приоритет (от высшего к низшему)
3. Дедлайн (более срочные идут первыми)
4. Позиция в общем списке задач

### 2. Поиск временных слотов

Для каждой задачи система:

1. Проверяет доступность временных слотов в расписании организации
2. Учитывает выходные и праздничные дни (используя календарь РФ)
3. Проверяет максимальное количество задач в день (по умолчанию 3)
4. Учитывает длительность задачи и перерывы между задачами

### 3. Планирование задач

Процесс планирования происходит в несколько этапов:

1. **Начальное планирование**:
   - Планируются задачи без зависимостей
   - Для каждой задачи ищется ближайший доступный слот
   - Если слот найден, задача добавляется в расписание

2. **Обработка зависимых задач**:
   - Задачи, заблокированные другими, ждут выполнения блокирующих задач
   - После разблокировки для них также ищутся доступные слоты
   - Процесс повторяется до тех пор, пока все задачи не будут запланированы или не достигнут лимит попыток

3. **Обработка неудачных случаев**:
   - Если задачу не удалось запланировать, она помечается как недоступная
   - Система делает до 3 попыток планирования с увеличением окна поиска

### 4. Ограничения и правила

- Задачи не планируются на выходные и праздничные дни
- В один день может быть запланировано не более 3 задач
- Учитывается время работы организаций
- Задачи с дедлайном должны быть запланированы до его истечения
- Между задачами оставляется время на перемещение

## Технические детали

### Временные слоты

Система работает с временными слотами следующим образом:

1. Получает доступные временные интервалы из расписания организации
2. Проверяет наложение с уже запланированными задачами
3. Учитывает длительность задачи
4. Проверяет количество задач в день

### Обработка ошибок

- При невозможности найти подходящий слот система делает несколько попыток с увеличением окна поиска
- Если задачу невозможно запланировать, она помечается как недоступная
- Все изменения в расписании происходят в транзакции базы данных

## Интеграция с календарем

Календарь в интерфейсе пользователя:

1. Отображает только доступные и незавершенные задачи
2. Подсвечивает выходные и праздничные дни
3. Блокирует прошедшие даты
4. Показывает индикаторы для дней с запланированными задачами

## Преимущества алгоритма

1. **Автоматизация**: минимизирует ручное планирование
2. **Оптимизация**: учитывает множество факторов при планировании
3. **Гибкость**: позволяет настраивать приоритеты и зависимости
4. **Масштабируемость**: может обрабатывать большое количество задач
5. **Предсказуемость**: следует четким правилам планирования 
